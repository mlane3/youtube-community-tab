!function(){"use strict";function t(){let o=[];function e(t,e,i){if(strLog="poziworldExtension.tabs._getSavedActiveTabOrItsIndex",Log.add(strLog,{intId:t,boolGetByWindowId:e,boolGetIndex:i}),i=window.poziworldExtension.utils.isType(i,"boolean")&&i,window.poziworldExtension.utils.isType(t,"number")){const n=window.poziworldExtension.utils.isType(e,"boolean")&&e?"intWindowId":"intId";return o[i?"findIndex":"find"]((function(o){return o[n]===t}))}return i?-1:{}}t.prototype.getSavedActiveTabs=function(){return o},t.prototype.saveActiveTab=function(t,e){if(strLog="poziworldExtension.tabs.saveActiveTab",Log.add(strLog,t),window.poziworldExtension.utils.isType(t,"object")&&!Global.isEmpty(t)){const i=t.intId;if(window.poziworldExtension.utils.isType(i,"number")){let n=this.getSavedActiveTabIndex(i);if(n>-1)o[n]=t;else{const e=t.intWindowId;if(!window.poziworldExtension.utils.isType(e,"number"))return!1;n=this.getSavedActiveTabIndex(e,!0),n>-1?o[n]=t:o.push(t)}return window.poziworldExtension.utils.isType(e,"boolean")&&e||this.onActiveTabsChange.dispatch(),!0}}return!1},t.prototype.removeActiveTab=function(t){if(strLog="poziworldExtension.tabs.removeActiveTab",Log.add(strLog,t),window.poziworldExtension.utils.isType(t,"number")){const e=this.getSavedActiveTabIndex(t);if(e>-1)return o=o.splice(e,1),this.onActiveTabsChange.dispatch(),!0}return!1},t.prototype.getSavedActiveTab=function(t,o){return strLog="poziworldExtension.tabs.getSavedActiveTab",Log.add(strLog,{intId:t,boolGetByWindowId:o}),e(t,o)},t.prototype.getSavedActiveTabIndex=function(t,o){return strLog="poziworldExtension.tabs.getSavedActiveTabIndex",Log.add(strLog,{intId:t,boolGetByWindowId:o}),e(t,o,!0)},this.init()}t.prototype.onActiveTabsChange=window.poziworldExtension.event,t.prototype.init=function(){strLog="poziworldExtension.tabs.init",Log.add(strLog),this.findActiveTabs(),browser.tabs.onActivated.addListener(this.handleTabsActivated.bind(this)),browser.tabs.onRemoved.addListener(this.handleTabsRemoved.bind(this)),browser.tabs.onReplaced.addListener(this.handleTabsReplaced.bind(this)),browser.tabs.onUpdated.addListener(this.handleTabsUpdated.bind(this))},t.prototype.findActiveTabs=function(){strLog="poziworldExtension.tabs.findActiveTabs",Log.add(strLog),browser.tabs.query({active:!0}).then(this.handleActiveTabsQueryComplete.bind(this))},t.prototype.handleActiveTabsQueryComplete=function(t){strLog="poziworldExtension.tabs.onActiveTabsQueryComplete",Log.add(strLog,t);for(let o=0,e=t.length;o<e;o++)this.processTabInfo(t[o])},t.prototype.handleTabsActivated=function(t){strLog="poziworldExtension.tabs.handleTabsActivated",Log.add(strLog,t),this.getTabInfoById(t.tabId)},t.prototype.handleTabsRemoved=function(t){strLog="poziworldExtension.tabs.handleTabsRemoved",Log.add(strLog,t),this.removeActiveTab(t)&&this.findActiveTabs()},t.prototype.handleTabsReplaced=function(t,o){strLog="poziworldExtension.tabs.handleTabsReplaced",Log.add(strLog,{intAddedTabId:t,intRemovedTabId:o}),this.getTabInfoById(t),this.removeActiveTab(o)},t.prototype.handleTabsUpdated=function(t,o,e){strLog="poziworldExtension.tabs.handleTabsUpdated",Log.add(strLog,{intId:t,objChangeInfo:o,objTab:e}),"complete"===o.status&&this.processTabInfo(e)},t.prototype.getTabInfoById=function(t){strLog="poziworldExtension.tabs.getTabInfoById",Log.add(strLog,t),browser.tabs.get(t).then(this.processTabInfo.bind(this))},t.prototype.processTabInfo=function(t){if(strLog="poziworldExtension.tabs.processTabInfo",Log.add(strLog,t),window.poziworldExtension.utils.isType(t,"object")&&!Global.isEmpty(t)){const o=t.active;if(!window.poziworldExtension.utils.isType(o,"boolean")||!o)return;const e=t.id;let i,n=t.url;if(window.poziworldExtension.utils.isNonEmptyString(n)){const t=document.createElement("a");let o;t.href=n,o=t.hostname,i=punycode.toUnicode(o),n=n.replace(o,i)}this.saveActiveTab({intId:e,intWindowId:t.windowId,strDomain:i,strUrl:n})}},void 0===window.poziworldExtension&&(window.poziworldExtension={}),window.poziworldExtension.tabs=new t}();