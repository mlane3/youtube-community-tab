const strPage="browserAction",strHideInOperaClass="hideInOpera",strOptionsCtaId="bractOpenOptionsPage",strCloseCtaId="bractClosePage",strTabAddressUrlId="sttbModeTabAddressUrl",strTabAddressDomainId="sttbModeTabAddressDomain",strModeOptionClass="sttbModeOption",strModeOptionEnabledId="sttbModeOptionEnabled",strModeOptionUrlId="sttbModeOptionUrl",strModeOptionDomainId="sttbModeOptionDomain",strReloadActiveTabCtaId="browserActionReloadActiveTabCta",arrSettingsToGet=[strConstDisabledDomainsSetting,strConstDisabledUrlsSetting];var objActiveTab,strTabId,strTabUrl,strTabDomain,$reloadActiveTabCta,BrowserAction={init:function(){$reloadActiveTabCta=document.getElementById(strReloadActiveTabCtaId),Page.hideInOpera(),window.poziworldExtension.i18n.init().then(Page.localize.bind(null,strPage)).then(window.poziworldExtension.incentive.setLinks),window.poziworldExtension.page.init(strPage),BrowserAction.addEventListeners(),BrowserAction.getActiveTabAddress()},addEventListeners:function(){addEvent(document.getElementById(strOptionsCtaId),"click",(function(t){Global.openOptionsPage(strOptionsCtaId)})),addEvent(document.getElementById(strCloseCtaId),"click",(function(t){window.close()})),addEvent(document.getElementsByClassName("sttbModeOption"),"click",(function(t){BrowserAction.changeSttbMode(t)})),addEvent($reloadActiveTabCta,"click",(function(t){BrowserAction.reloadActiveTab()}))},getActiveTabAddress:function(){browser.tabs.query({active:!0,currentWindow:!0}).then((function(t){if("object"==typeof(objActiveTab=t[0])&&!Global.isEmpty(objActiveTab)){const t=document.createElement("a"),n=document.getElementById(strTabAddressUrlId),o=document.getElementById(strTabAddressDomainId);var e;strTabId=objActiveTab.id,strTabUrl=objActiveTab.url,t.href=strTabUrl,e=t.hostname,strTabDomain=punycode.toUnicode(e),o.innerText=strTabDomain,o.title=strTabDomain,strTabUrl=strTabUrl.replace(e,strTabDomain),n.innerText=strTabUrl,n.title=strTabUrl,BrowserAction.getActiveTabSettings()}}))},getActiveTabSettings:function(){window.poziworldExtension.utils.getStorageItems(StorageSync,arrSettingsToGet,"getActiveTabSettings",(function(t){var e=t[strConstDisabledDomainsSetting];if(Array.isArray(e)&&~e.indexOf(strTabDomain))document.getElementById(strModeOptionDomainId).checked=!0;else{var n=t[strConstDisabledUrlsSetting];Array.isArray(n)&&~n.indexOf(strTabUrl)?document.getElementById(strModeOptionUrlId).checked=!0:document.getElementById(strModeOptionEnabledId).checked=!0}}))},changeSttbMode:function(t){const e=strLog="changeSttbMode",n=t.target.id;window.poziworldExtension.utils.getStorageItems(StorageSync,arrSettingsToGet,e,(function(t){if("object"==typeof t){var e={},o=-1,i=-1,s=function(t,n,o,i){-1===t&&(o.push(i),e[n]=o)},r=function(t,n,o){-1!==t&&(o.splice(t,1),e[n]=o)},a=t[strConstDisabledDomainsSetting];Array.isArray(a)?i=a.indexOf(strTabDomain):a=[];var d=t[strConstDisabledUrlsSetting];Array.isArray(d)?o=d.indexOf(strTabUrl):d=[],n===strModeOptionDomainId?(s(i,strConstDisabledDomainsSetting,a,strTabDomain),r(o,strConstDisabledUrlsSetting,d)):n===strModeOptionUrlId?(r(i,strConstDisabledDomainsSetting,a),s(o,strConstDisabledUrlsSetting,d,strTabUrl)):n===strModeOptionEnabledId&&(r(i,strConstDisabledDomainsSetting,a),r(o,strConstDisabledUrlsSetting,d)),Global.isEmpty(e)||window.poziworldExtension.utils.setStorageItems(StorageSync,e,strLog),Page.toggleElement($reloadActiveTabCta,!0)}}))},reloadActiveTab:function(){browser.tabs.reload(objActiveTab.id).then((function(){Page.toggleElement($reloadActiveTabCta,!1)}))}};document.addEventListener("DOMContentLoaded",BrowserAction.init);